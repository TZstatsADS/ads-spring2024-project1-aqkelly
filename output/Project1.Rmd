---
title: "Will your source of happiness change after 50?"
output:
  html_document:
    df_print: paged
---

*People change the way of thinking and behaving as they grow, but what about the source of happiness? Will the things that interest you in your 20s also interest you after your 50s?*

This report will use a dataset with 100,000 happy moments to answer this question.

1. Description of the data
3. Analysis
4. Conclusion

## Description of the data

`raw data`:

HappyDB is a corpus of 100,000+ crowd-sourced happy moments. The data is collected from Amazon Mechanical Turk (MTurk.) over 3 months.

We will used the clean data for this report, and also the demographic table.

`data used for analysis`:

We will separate the data into two groups depending on the candidates age: below 50 of above (equal to) 50. Also, we only consider age between (including) 17 to 80.

```{r load data, message=FALSE, warning=FALSE, include=FALSE}
hm_data <- read.csv("../output/processed_moments.csv")

urlfile<-'https://raw.githubusercontent.com/rit-public/HappyDB/master/happydb/data/demographic.csv'
demo_data <- read.csv(urlfile)
```

```{r load libraries, message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(tidytext)
library(DT)
library(scales)
library(wordcloud2)
library(gridExtra)
library(ngram)
library(shiny) 
library(tm)
library(wordcloud)
library(igraph)
library(ggraph)
library(rsconnect)
library(dplyr)
```

```{r combining data, message=FALSE, warning=FALSE, include=FALSE}
hm_data_below50 <- hm_data %>%
  inner_join(demo_data, by = "wid") %>%
  select(wid,
         original_hm,
         gender, 
         reflection_period,
         age, 
         text) %>%
  mutate(count = sapply(hm_data$text, wordcount)) %>%
  filter(gender %in% c("m", "f")) %>%
  filter(age < 50 & age >= 17)


hm_data_above50 <- hm_data %>%
  inner_join(demo_data, by = "wid") %>%
  select(wid,
         original_hm,
         gender, 
         reflection_period,
         age, 
         text) %>%
  mutate(count = sapply(hm_data$text, wordcount)) %>%
  filter(gender %in% c("m", "f")) %>%
  filter(age >= 50 & age <= 80)

hm_data <- hm_data %>%
  inner_join(demo_data, by = "wid") %>%
  select(wid,
         original_hm,
         gender, 
         reflection_period,
         age, 
         text) %>%
  mutate(count = sapply(hm_data$text, wordcount)) %>%
  filter(gender %in% c("m", "f")) %>%
  filter(age >= 17 & age <= 80) %>%
  mutate(age_above_50 = ifelse(age < 50, 'no', 'yes'))
```

## Analysis

```{r bag of words, message=FALSE, warning=FALSE, include=FALSE}
bag_of_words_above50 <-  hm_data_above50 %>%
  unnest_tokens(word, text)

word_count_above50 <- bag_of_words_above50 %>%
  count(word, sort = TRUE)

bag_of_words_below50 <-  hm_data_below50 %>%
  unnest_tokens(word, text)

word_count_below50 <- bag_of_words_below50 %>%
  count(word, sort = TRUE)

bag_of_words <-  hm_data %>%
  unnest_tokens(word, text)

word_count <- bag_of_words %>%
  count(word, sort = TRUE)
```

```{r,warning=FALSE, message=FALSE,echo=FALSE}
# compare the word porportion between the two age groups
temp <- bag_of_words %>%
      count(age_above_50, word) %>%
      group_by(age_above_50) %>%
      mutate(proportion = n / sum(n)) %>% 
      select(-n) %>% 
      spread(age_above_50, proportion)

ggplot(temp, aes_string(x = colnames(temp)[2], y = colnames(temp)[3]), color = 1) +
      geom_abline(color = "gray40", lty = 2) +
      geom_jitter(alpha = 0.1, size = 1, width = 0.3, height = 0.3) +
  labs(title="Words Proportion for people above/below 50")+
      geom_text(aes(label = word), check_overlap = TRUE, vjust = 1) +
      scale_x_log10(labels = percent_format()) +
      scale_y_log10(labels = percent_format()) +
      scale_color_gradient(limits = c(0, 0.001), low = "darkslategray4", high = "gray75")
```

According to the above graph, people above 50 earns happiness from their grandkids more often than people below 50. This is very reasonable seems most of those do not have a grandkid yet. However, other sources seems to be similar.

```{r bigram, fig.height=5, fig.width=8, message=FALSE, warning=FALSE, include=FALSE}
hm_bigrams_above50 <- hm_data_above50 %>%
  filter(count != 1) %>%
  unnest_tokens(bigram, text, token = "ngrams", n = 2)

bigram_counts_above50 <- hm_bigrams_above50 %>%
  separate(bigram, c("word1", "word2"), sep = " ") %>%
  count(word1, word2, sort = TRUE)

hm_bigrams_below50 <- hm_data_below50 %>%
  filter(count != 1) %>%
  unnest_tokens(bigram, text, token = "ngrams", n = 2)

bigram_counts_below50 <- hm_bigrams_below50 %>%
  separate(bigram, c("word1", "word2"), sep = " ") %>%
  count(word1, word2, sort = TRUE)
```

```{r,message=FALSE,warning=FALSE,echo=FALSE}
par(mfrow = c(1,2))

wordcloud(word_count_below50$word,word_count_below50$n ,
          scale=c(4,0.1),
          max.words=50,
          min.freq=1,
          random.order=FALSE,
          rot.per=0.5,
          use.r.layout=F,
          random.color=FALSE,
          colors=brewer.pal(10,"Oranges"))
title("Age group below 50", line = 1)

wordcloud(word_count_above50$word,word_count_above50$n ,
          scale=c(2.5,0.1),
          max.words=50,
          min.freq=5,
          random.order=FALSE,
          rot.per=0.3,
          use.r.layout=F,
          random.color=FALSE,
          colors=brewer.pal(10,"Oranges"))
title("Age group above 50", line = 1)
```

The two words clouds above clearly shows the differences between the two age groups. For people with age below 50, most of the happiness come from their friend, while for people above 50, family words (including words daughter, husband, son, wife, home) appear way more common.

```{r,warning=FALSE, message=FALSE,echo=FALSE}
plot_above50 = word_count_above50[1:15,] %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  labs(title = "Word Frequency for Age Above 50")+
  xlab(NULL) +
  ylab("Word Frequency")+
  coord_flip()

plot_below50 = word_count_below50[1:15,] %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  labs(title = "Word Frequency for Age Below 50")+
  xlab(NULL) +
  ylab("Word Frequency")+
  coord_flip()

grid.arrange(plot_below50, plot_above50, ncol = 2)
``` 

If we look at the frequency plots of the 15 most common words for two age groups, we can clearly see that the proportion of family words become larger for people above 50. Also, young people tend to earn more happiness from game or job than the old.

#### Will different gender play a different roles? Let's see.

```{r,message=FALSE,warning=FALSE,echo=FALSE}
bag_of_words_above50_f <-  hm_data_above50[hm_data_above50$gender == 'f',] %>%
  unnest_tokens(word, text)

word_count_above50_f <- bag_of_words_above50_f  %>%
  count(word, sort = TRUE)

bag_of_words_below50_f <-  hm_data_below50[hm_data_below50$gender == 'f',] %>%
  unnest_tokens(word, text)

word_count_below50_f <- bag_of_words_below50_f %>%
  count(word, sort = TRUE)

bag_of_words_above50_m <-  hm_data_above50[hm_data_above50$gender == 'm',] %>%
  unnest_tokens(word, text)

word_count_above50_m <- bag_of_words_above50_m  %>%
  count(word, sort = TRUE)

bag_of_words_below50_m <-  hm_data_below50[hm_data_below50$gender == 'm',] %>%
  unnest_tokens(word, text)

word_count_below50_m <- bag_of_words_below50_m %>%
  count(word, sort = TRUE)
```

```{r,message=FALSE,warning=FALSE,echo=FALSE}
par(mfrow = c(1,2))
wordcloud(word_count_below50_f$word,word_count_below50_f$n ,
          scale=c(4,0.1),
          max.words=50,
          min.freq=1,
          random.order=FALSE,
          rot.per=0.5,
          use.r.layout=F,
          random.color=FALSE,
          colors=brewer.pal(10,"Oranges"))
title("Age group below 50 for female", line = 1)

wordcloud(word_count_above50_f$word,word_count_above50_f$n ,
          scale=c(3,0.1),
          max.words=50,
          min.freq=5,
          random.order=FALSE,
          rot.per=0.3,
          use.r.layout=F,
          random.color=FALSE,
          colors=brewer.pal(10,"Oranges"))
title("Age group above 50 for female", line = 1)

wordcloud(word_count_below50_m$word,word_count_below50_m$n ,
          scale=c(4,0.1),
          max.words=50,
          min.freq=1,
          random.order=FALSE,
          rot.per=0.5,
          use.r.layout=F,
          random.color=FALSE,
          colors=brewer.pal(10,"Oranges"))
title("Age group below 50 for male", line = 1)

wordcloud(word_count_above50_m$word,word_count_above50_m$n ,
          scale=c(4,0.1),
          max.words=50,
          min.freq=5,
          random.order=FALSE,
          rot.per=0.3,
          use.r.layout=F,
          random.color=FALSE,
          colors=brewer.pal(10,"Oranges"))
title("Age group above 50 for male", line = 1)
```

For female, the situation is similar with the population. However, for male, the word "wife" overtake the role of "friend".

```{r,warning=FALSE, message=FALSE,echo=FALSE}
plot_above50_f = word_count_above50_f[1:15,] %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  labs(title = "Age Above 50 for Female")+
  xlab(NULL) +
  ylab("Word Frequency")+
  coord_flip()

plot_below50_f = word_count_below50_f[1:15,] %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  labs(title = "Age Below 50 for Female")+
  xlab(NULL) +
  ylab("Word Frequency")+
  coord_flip()

grid.arrange(plot_below50_f, plot_above50_f, ncol = 2)
``` 

We can see that overall the main sources of happiness for female do not change a lot as age increase. Both friends and family place an important roles in generating happiness, with the proportion of family become larger for those above 50.

```{r,warning=FALSE, message=FALSE,echo=FALSE}
plot_above50_m = word_count_above50_m[1:15,] %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  labs(title = "Age Above 50 for Male")+
  xlab(NULL) +
  ylab("Word Frequency")+
  coord_flip()

plot_below50_m = word_count_below50_m[1:15,] %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  labs(title = "Age Below 50 for Male")+
  xlab(NULL) +
  ylab("Word Frequency")+
  coord_flip()

grid.arrange(plot_below50_m, plot_above50_m, ncol = 2)
``` 

However, for male, "wife" takes over the place of "friend" and becomes the most frequent word for those above 50, while for those below 50, the frequency of "wife" is less than the half of the word "friend".

## Conclusion

Family and friend seems to be the most common source of happiness for people over 50, while for those below 50 friend is the most important source. Game and job are also the frequent words mention by the young but not the old. 

For female, the word frequency does not change a lot from age below 50 to age above 50. However, for male, wife becomes the most frequent word after their 50s. Though the differences, both gender put more attention on family after 50s.

Limitation: The original data has age range from 2 to 233. This is clearly an error but there is not clear instruction. Hence, I consider age group from 17 to 80 only, but there could still be some error in the age.